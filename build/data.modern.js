function t(t,s){if(e(t))for(let e=0;e<t.length;e++)s(e,t[e]);else for(const e in t)s(e,t[e])}const{isArray:e}=Array,s=()=>{},i=Symbol("value"),h=t=>new g(v.value(t)),n=Symbol("view"),l={value:i,view:n};h.random=t=>crypto.randomUUID();const o=t=>void 0===t?void 0:t[n]?t[n].value:structuredClone(t);class r{constructor(){this.view=new v(this)}update(t,e){if(t instanceof g)throw new Error("cannot set value to another data, use a linked value instead");0===e.length?this.XU0(t):1===e.length?this.BU1([e[0],t]):this.BU2([e,t])}insert(t,e,s){if(t instanceof g)throw new Error("cannot set value to another data, use a linked value instead");s=void 0===s?s:`${s}`,0===e.length?this.BI0([s,t]):this.BI2([e,t,s])}remove(t){0===t.length?this.XR0():1===t.length?this.BR1([t[0]]):this.BR2([t])}XR0(){if(void 0===this.view.value)return!1;const t=this.view.value;this.view.value=void 0,this.view.XR0(t)}BR1A(t){const e=[];for(let i=0;i<t.length;i++){var s;const h=t[i],n=null==(s=this.view.value)?void 0:s[h];this.view.value.splice(h,1),e.push(h),e.push(n)}this.view.BR1(e)}BR1(t){if(e(this.view.value))return this.BR1A(t);const s=[];for(let e=0;e<t.length;e++){var i;const h=t[e],n=null==(i=this.view.value)?void 0:i[h];void 0!==n&&(delete this.view.value[h],s.push(h),s.push(n))}this.view.BR1(s)}BR2(t){const s=[];t:for(let i=0;i<t.length;i++){const h=t[i],[n,...l]=h.slice().reverse();let o=this.view.value;if("object"!=typeof o)return;for(;l.length;){const t=l.pop();if("object"!=typeof o)continue t;o=o[t]}if(void 0===o[n])continue t;const r=o[n];e(o)?o.splice(n,1):delete o[n],s.push(h,r)}this.view.BR2(s)}XU0(t){this.view.value!==t&&(this.view.value=t,this.view.XU0())}BU1(t){const e=[],s=[];"object"!=typeof this.view.value&&(this.view.value={});for(let n=0;n<t.length;n++){var i,h;const l=t[n++],o=t[n];(null==(i=this.view.value)?void 0:i[l])!==o&&(void 0===(null==(h=this.view.value)?void 0:h[l])?s.push(l,o):e.push(l,o),this.view.value[l]=o)}this.view.BU1(e),this.view.BI0(s)}BU2(t){"object"!=typeof this.view.value&&(this.view.value={});for(let e=0;e<t.length;e++){const s=t[e++],i=t[e],[h,...n]=s.slice().reverse();let l=this.view.value;for(;n.length;){const t=n.pop();l="object"==typeof l[t]?l[t]:l[t]={}}l[h]!==i&&(l[h]=i)}this.view.BU2(t)}BI0(t){if(e(this.view.value))return this.BI0A(t);"object"!=typeof this.view.value&&(this.view.value={});for(let e=0;e<t.length;e++){var s,i,n;const l=null!=(i=t[s=e++])?i:t[s]=""+h.random(this.view.value),o=t[e];(null==(n=this.view.value)?void 0:n[l])!==o&&(this.view.value[l]=o)}this.view.BI0(t)}BI0A(t){for(let e=0;e<t.length;e+=2){const s=t[e],i=t[e+1];void 0===s?t[e]=""+(this.view.value.push(i)-1):this.view.value.splice(s,0,i)}this.view.BI0(t)}BI2(t){"object"!=typeof this.view.value&&(this.view.value={});for(let l=0;l<t.length;l++){const o=t[l++],r=t[l++],a=o.slice().reverse();let v=this.view.value;for(;a.length;){const t=a.pop();v="object"==typeof v[t]?v[t]:v[t]={}}var s,i,n;e(v)?void 0===t[l]?null!=t[s=l]||(t[s]=""+(v.push(r)-1)):v.splice(t[l],0,r):v[null!=(n=t[i=l])?n:t[i]=""+h.random(v)]=r}this.view.BI2(t)}}class a extends r{}class v{constructor(t){this.res=t,this.key=[],this.sinks=new Set,this.views=new Map}static child(t,e){var s;const i=new v(t.res);return i.p=t,i.key=[...t.key,e],i.name=e,i.XU0(null==(s=t.value)?void 0:s[e]),i}static value(t){if(t instanceof g)return new c(t);{const e=new r;return e.XU0(t),e.view}}XR0(t){this.p&&(this.value=void 0),this.each((e,s)=>{s.value===(null==t?void 0:t[e])&&void 0===s.value||s.XR0(null==t?void 0:t[e])}),this.sink(e=>e.XR0(t,this))}BR1(t){if(t.length){if(e(this.value)){if(this.views.size){let e=Infinity;for(let s=0;s<t.length&&(t[s]<e&&(e=t[s]),e);s+=2);this.V1(e)}}else for(let e=0;e<t.length;e+=2){var s;null==(s=this.get_named(t[e]))||s.XR0(t[e+1])}for(const e of this.sinks){const s=e.deref();s?s.BR1(t,this):this.sinks.delete(s)}}}BR2(t){for(let i=0;i<t.length;i++){var e,s;const[h,...n]=t[i++],l=t[i];1===n.length?null==(e=this.get_named(h))||e.BR1([n[0],l]):null==(s=this.get_named(h))||s.BR2([n,l])}this.sink(e=>e.BR2(t,this))}XU0(){var t;this.p&&(this.value=null==(t=this.p.value)?void 0:t[this.name]),this.each((t,e)=>{var s;void 0!==(null==(s=this.value)?void 0:s[t])?e.XU0():void 0!==e.value&&e.XR0(e.value)}),this.sink(t=>t.XU0(this.value,this))}BU1(t){var e;if(t.length){this.p&&(this.value=null==(e=this.p.value)?void 0:e[this.name]);for(let e=0;e<t.length;e++){var s;null==(s=this.get_named(t[e++]))||s.XU0()}this.sink(e=>e.BU1(t,this))}}BU2(t){var e;this.p&&(this.value=null==(e=this.p.value)?void 0:e[this.name]);for(let e=0;e<t.length;e++){var s,i;const[h,...n]=t[e++],l=t[e];1===n.length?null==(s=this.get_named(h))||s.BU1([n[0],l]):null==(i=this.get_named(h))||i.BU2([n,l])}this.sink(e=>e.BU2(t,this))}BI0(t){var s;if(t.length){if(this.p&&(this.value=null==(s=this.p.value)?void 0:s[this.name]),e(this.value))return this.BI0A(t);for(let e=0;e<t.length;e++){var i;null==(i=this.get_named(t[e++]))||i.XU0()}this.sink(e=>e.BI0(t,this))}}BI0A(t){if(this.views.size){let e=Infinity;for(let s=0;s<t.length;s+=2)t[s]<e&&(e=t[s]);this.V1(e)}this.sink(e=>e.BI0(t,this))}BI2(t){var e;this.p&&(this.value=null==(e=this.p.value)?void 0:e[this.name]);for(let e=0;e<t.length;){var s,i;const[h,...n]=t[e++],l=t[e++],o=t[e++];n.length?null==(s=this.get_named(h))||s.BI2([n,l,o]):null==(i=this.get_named(h))||i.BI0([o,l])}this.sink(e=>e.BI2(t,this))}V1(t){for(let e=t;e<this.value.length+1;e++){const t=this.get_named(`${e}`);t&&t.value!==this.value[e]&&t.XU0()}}some_sink(t){let e;for(const s of this.sinks){const i=null==s.deref?void 0:s.deref();if(i){if(e=t(s))return e}else this.sinks.delete(i)}}sink(t){for(const e of this.sinks){const s=null==e.deref?void 0:e.deref();s?t(s):this.sinks.delete(s)}}each(t){for(const[e,s]of this.views){const i=null==s.deref?void 0:s.deref();i?t(e,i):this.views.delete(e)}}get_or_create_named(t){var e,s;return null!=(e=null==(s=this.views.get(t))||null==s.deref?void 0:s.deref())?e:function(t,e,s){return t.set(e,new WeakRef(s)),s}(this.views,t,v.child(this,t))}get_named(t){var e;const s=null==(e=this.views.get(t))||null==e.deref?void 0:e.deref();return s||this.views.delete(t),s}disconnect(t){for(const e of this.sinks){const s=null==e.deref?void 0:e.deref();if(s===t){this.sinks.delete(e);break}s||this.sinks.delete(e)}}connect(t){this.sinks.add(new WeakRef(t))}}class u{}class c extends v{constructor(t){super(),this.src=t[l.view],this.update(this.src)}update(t,e=[]){if(e.length)return this.src.res.update(t,e);if(t instanceof g&&(t=t[l.view]),!(t instanceof v))throw new Error("cannot set linked value to non-reactive source");this.src.disconnect(this),this.src=t,this.src.connect(this),this.XU0(this.src.value)}insert(...t){return this.src.res.insert(...t)}remove(...t){return this.src.res.remove(...t)}XU0(t){this.sink(e=>e.XU0(t,this))}BU1(t){this.sink(e=>e.BU1(t,this))}BU2(t){this.sink(e=>e.BU2(t,this))}XR0(t){this.sink(e=>e.XR0(t,this))}BR1(t){this.sink(e=>e.BR1(t,this))}BR2(t){this.sink(e=>e.BR2(t,this))}BI0(t){this.sink(e=>e.BI0(t,this))}BI2(t){this.sink(e=>e.BI2(t,this))}get value(){return this.src.value}get res(){return this}set res(t){}}function d(t,e){for(let s=0;s<t.length;s++)e(t[s++],t[s])}class p{constructor(t,e){this.update=(t,e)=>this.arr.push({type:"update",key:t,value:o(e)}),this.remove=(t,e)=>this.arr.push({type:"remove",key:t,value:o(e)}),this.insert=(t,e,s)=>this.arr.push({type:"insert",key:t,value:o(e),at:s}),this.p=t,this.arr=e,this.update([],t.value)}XU0(t){this.update([],t)}BU1(t){d(t,(t,e)=>this.update([t],e))}BU2(t){d(t,(t,e)=>this.update(t,e))}BI0(t){d(t,(t,e)=>this.insert([],e,t))}BI2(t){!function(t,e){for(let s=0;s<t.length;s++)e(t[s++],t[s++],t[s])}(t,(t,e,s)=>this.insert(t,e,s))}XR0(t){this.remove([],t)}BR1(t){d(t,(t,e)=>this.remove([t],e))}BR2(t){d(t,(t,e)=>this.remove(t,e))}R0(t){this.arr.push({type:"remove",key:[],value:o(t)})}R1(t,e){this.arr.push({type:"remove",key:[t],value:o(e)})}R2(t,e){this.arr.push({type:"remove",key:t,value:o(e)})}U0(t){this.arr.push({type:"update",key:[],value:o(t)})}U1(t,e){this.arr.push({type:"update",key:[t],value:o(e)})}U2(t,e){this.arr.push({type:"update",key:t,value:o(e)})}I0(t,e){this.arr.push({type:"insert",value:o(t),at:e})}I1(t,e,s){this.arr.push({type:"insert",key:[t],value:o(e),at:s})}I2(t,e,s){this.arr.push({type:"insert",key:t,value:o(e),at:s})}}const f=new WeakMap;class w extends u{constructor(t,e,s){var i;super(),this.p=void 0,this.obj=void 0,this.prop=void 0,this.p=t,this.obj=e,this.prop=s,this.obj[s]=t.value;const h=null!=(i=f.get(e))?i:new Set;h.add(this),f.set(e,h)}XU0(t){this.obj[this.prop]=t}XR0(){this.XU0(this.p.value)}BU1(){this.XU0(this.p.value)}BR1(){this.XU0(this.p.value)}BI0(){this.XU0(this.p.value)}BU2(){this.XU0(this.p.value)}BR2(){this.XU0(this.p.value)}BI2(){this.XU0(this.p.value)}}class g{constructor(t){return this.view=void 0,this.view=t,new Proxy(s,this)}deleteProperty(t,e){const{res:s,key:i}=this.view,h=e===l.value?i:[...i,""+e];return s.remove(h),!0}set(t,e,s){const{res:i,key:h}=this.view,n=e===l.value?h:[...h,e];return i.update(s,n),!0}get(t,e){return e===Symbol.toPrimitive?t=>{var e;return t?null==(e=this.view.value)?void 0:e.toString():+this.view.value}:e===Symbol.iterator?this.iterator:e===l.reactive||(e===l.view?this.view:e===l.value?this.view.value:new g(this.view.get_or_create_named(e)))}apply(t,s,i){var h;const{p:n,name:l}=this.view;if(!n)throw new Error("cannot invoke a root value!");if("connect"===l)return function(t,s,i){if(e(s)){const e=new p(t,s);return t.sinks.add(new WeakRef(e)),s}if("object"==typeof s&&"string"==typeof i){const e=new w(t,s,i);return t.sinks.add(new WeakRef(e)),s}if("object"==typeof s&&"function"==typeof i){const e=new FunctionSink(t,s,i);return t.sinks.add(new WeakRef(e)),s}return t.sinks.add(new WeakRef(s)),s}(n,...i);const o=null==(h=$[l])?void 0:h.call($,...i);if(o){let t=n.some_sink(t=>{if(t instanceof o)return t.matches(...i)});return t||n.sinks.add(new WeakRef(t=new o(n,...i))),new g(t.view)}const[r,a]=i;return"remove"===l?this.view.res.remove(n.key):"update"===l?this.view.res.update(r,n.key):"insert"===l?this.view.res.insert(r,n.key,a):void 0}getPrototypeOf(t){return g.prototype}*iterator(t=0){for(;;)yield this[t++]}}class B extends a{matches(t,[e,s]){return this.col===t&&this.plo===e&&this.phi===s}constructor(t,e,s){super(),this.p=t,this.col=e,this.plo=s[0],this.phi=s[1],this.sorted=[],this.find=z(t=>this.p.value[t][e]),s instanceof g?s.connect(this,"extent"):(s[0].connect(this,"lo"),s[1].connect(this,"hi")),this.XU0(t.value)}set lo(t){this.extent=t>this.hi_val?[this.hi_val,t]:[t,this.hi_val]}set hi(t){this.extent=t<this.lo_val?[t,this.lo_val]:[this.lo_val,t]}set extent([t=-Infinity,s=Infinity]){const i=(t=+t)<(s=+s)?t:s,h=t<s?s:t;if(!this.view.value)return[this.lo_val,this.hi_val]=[i,h];if(-Infinity===i&&Infinity===h)return this.hi_index=this.lo_index=void 0,[this.lo_val,this.hi_val]=[i,h],this.view.XU0(this.view.value=this.p.value);if(i===h)return this.hi_index=this.lo_index=void 0,[this.lo_val,this.hi_val]=[i,h],this.view.XU0(this.view.value=e(this.p.value)?[]:{});const n=[],l=[];let o,r;if(null!=this.lo_index||(this.lo_index=this.find(this.sorted,this.lo_val)),null!=this.hi_index||(this.hi_index=this.find(this.sorted,this.hi_val)),h<this.hi_val){for(;(r=this.p.value[o=this.sorted[this.hi_index-1]])&&r[this.col]>h;)this.hi_index--,l.push(o,r),this.view.value[o]=void 0;this.lo_index>this.hi_index&&(this.lo_index=this.hi_index)}if(i>this.lo_val){for(;(r=this.p.value[o=this.sorted[this.lo_index]])&&r[this.col]<i;)this.lo_index++,l.push(o,r),this.view.value[o]=void 0;this.hi_index<this.lo_index&&(this.hi_index=this.lo_index)}if(h>this.hi_val)for(;(r=this.p.value[o=this.sorted[this.hi_index]])&&r[this.col]<h;)this.hi_index++,n.push(o,r),this.view.value[o]=r;if(i<this.lo_val)for(;(r=this.p.value[o=this.sorted[this.lo_index-1]])&&r[this.col]>i;)this.lo_index--,n.push(o,r),this.view.value[o]=r;this.lo_val=i,this.hi_val=h,this.view.BI0(n),this.view.BR1(l)}XU0(s){const{col:i}=this;if(this.lo_index=void 0,this.hi_index=void 0,"object"!=typeof s)return super.XU0();const h=e(s)?[]:{};this.sorted=[],t(s,(t,e)=>{this.sorted.push(""+t),e[i]>=this.lo_val&&e[i]<=this.hi_val&&(h[t]=s[t])}),this.sorted.sort((t,e)=>{const h=s[t][i],n=s[e][i];return h>n?1:h<n?-1:0}),super.XU0(h)}}class m extends a{matches(t,e){return this.col_name==t&&this.n==e}constructor(t,e,s,i){super(),this.p=t,this.n=i,this.col=e,this.col_name=s,this.XU0(t.value)}XR0(){this.sorted=[],this.view.XU0(this.view.value=[])}XU0(t){if("object"!=typeof t)return this.XR0();this.sorted=Object.keys(t).sort((e,s)=>{const i=this.col(t[e]),h=this.col(t[s]);return i>h?-1:i<h?1:0}),this.view.XU0(this.view.value=this.sorted.slice(0,this.n).map(e=>t[e]))}BR1(t){for(let e=0;e<t.length;e++){const s=this.get_index(t[e++]);if(this.sorted.splice(s,1),s>=this.n)return;super.BR1A([s]);const i=this.view.value.length;this.sorted.length>i&&super.BI0A([i,this.p.value[this.sorted[i]]])}}BU1(t){for(let e=0;e<t.length;e++){const s=t[e++],i=t[e],{n:h,p:n,sorted:l}=this;let o=this.get_index(s);if(-1===o){this.BI0([s,i]);continue}let r=this.find(this.col(this.p.value[s]));if(o!==r){if(r>o&&r--,l.splice(o,1),l.splice(r,0,s),o>=h&&r>=h);else if(o>=h&&r<h)super.BR1A([h-1]),super.BI0A([r,n.value[l[r]]]);else if(o<h&&r>=h)super.BR1A([o]),super.BI0A([h-1,n.value[l[h-1]]]);else if(o<h&&r<h){const t=o<r?r:o;for(let e=o<r?o:r;e<=t;e++)super.BU1([""+e,n.value[l[e]]])}}else super.BU1([o,i])}}BI0(t){for(let e=0;e<t.length;e++){const s=t[e++],i=t[e],h=this.find(this.col(this.p.value[s]));if(this.sorted.splice(h,0,s),h>=this.n)return;this.view.value.length===this.n&&super.BR1A([this.n-1]),super.BI0A([h,i])}}BR2(t){for(let e=0;e<t.length;e++){const[s,i,...h]=t[e++],n=t[e];if(i===this.col_name)this.U1(changes,s,this.p.value[s]);else{const t=this.get_index(s);t<this.n&&this.view.BR2([[`${t}`,i,...h],n])}}}BU2(t){for(let e=0;e<t.length;e++){const[s,i,...h]=t[e++],n=t[e];if(i===this.col_name)this.BU1([s,this.p.value[s]]);else{const t=this.get_index(s);t<this.n&&this.view.BU2([[`${t}`,i,...h],n])}}}BI2(t){for(let e=0;e<t.length;e++){const[s,...i]=t[e++],h=t[e++],n=t[e];if(!this.has(s)){this.BI0([s,this.p.value[s]]);continue}const l=this.get_index(s);l>=this.n||this.view.BI2([[`${l}`,...i],h,n])}}get_index(t){return this.sorted.indexOf(t)}has(t){return!!~this.get_index(t)}}m.prototype.find=function(t,e=0,s=this.sorted.length){for(;e<s;){const i=e+s>>>1;this.col(this.p.value[this.sorted[i]])<t?s=i:e=i+1}return e};class U extends m{constructor(t,e,s=Infinity){super(t,t=>t[e],e,s)}}class y extends m{constructor(t,e=Infinity){super(t,t=>t,i,e)}}class X extends a{constructor(t,e){super(),this.p=t,this.n=e,this.XU0(this.p.value)}XR0(){this.XU0(this.p.value)}BU1(t){t[0]<this.last&&this.XU0(this.p.value)}BI0(t){(t[0]<this.last||this.view.value.length<this.n)&&this.XU0(this.p.value)}BR1(t){(t[0]<this.last||this.view.value.length<this.n)&&this.XU0(this.p.value)}XU0(t){if(this.view.value=[],this.index=[],"object"==typeof t)if(e(t)){let e=-1;for(;e<t.length&&(void 0===t[++e]||(this.view.value.push(t[e]),this.index.push(e),this.view.value.length!==this.n)););}else for(const e in t)if(void 0!==t[e]&&(this.view.value.push(t[e]),this.index.push(e),this.view.value.length===this.n))break;this.last=this.index.at(-1),this.view.XU0(this.view.value)}}class _ extends a{constructor(t,e){super(),this.p=t,this.fn=e,this.XU0(this.p.value)}XU0(t){const e=this.fn(t,this.view.value);e!==this.view.value&&this.view.XU0(this.view.value=e)}XR0(){this.XU0(this.p.value)}BR1(){this.XU0(this.p.value)}BU1(){this.XU0(this.p.value)}BI0(){this.XU0(this.p.value)}BR2(){this.XU0(this.p.value)}BU2(){this.XU0(this.p.value)}BI2(){this.XU0(this.p.value)}}class R extends a{constructor(t,e,s=1e3){super(),this.calc=()=>{delete this.pending;const t=this.fn(this.p.value,this.view.value);if(t===this.view.value)return;const e=[];super.U0({value:t},e),this.view.bulk(e)},this.p=t,this.fn=e,this.ms=s,this.bulk()}bulk(){this.pending||(this.pending=setTimeout(this.calc,this.ms))}}class x extends a{process(){throw new Error("not implemented, process:",this.name)}loop(t,e,s){const i=[],h=[],n=[];for(let o=0;o<t.length;o+=e){var l;const e=s?t[o][0]:t[o],r=null==(l=this.view.value)?void 0:l[e],a=this.process(this.p.value[e],e,r),v=void 0!==r,u=void 0!==a;v&&u?(i.push(e,a),this.view.value[e]=a):!v&&u?(h.push(e,a),this.view.value[e]=a):v&&!u&&(n.push(e,r),delete this.view.value[e])}this.view.BU1(i),this.view.BI0(h),this.view.BR1(n)}XU0(t){if("object"!=typeof t)return this.view.XU0(this.view.value=void 0);const s=e(t)?[]:{};for(const e in t){var i;const h=this.process(t[e],e,null==(i=this.view.value)?void 0:i[e]);void 0!==h&&(s[e]=h)}this.view.XU0(this.view.value=s)}BU1(t){this.loop(t,2,!1)}BU2(t){this.loop(t,2,!0)}BI0(t){this.loop(t,2,!1)}BI2(t){this.loop(t,3,!0)}BR2(t){this.loop(t,2,!0)}XR0(){super.XR0()}BR1(t){const e=[];for(let i=0;i<t.length;i++){var s;const h=t[i++],n=null==(s=this.view.value)?void 0:s[h];void 0!==n&&(delete this.view.value[h],e.push(h,n))}this.view.BR1(e)}}class k extends x{constructor(t,e){super(),this.p=t,this.n=0,this.all=0,this.fn=e,this.XU0(this.p.value)}process(t,e,s){return this.fn(t,e,s)?t:void 0}}function I(t,e){const s=t.concat([]);for(;s.length;){var i;e=null==(i=e)?void 0:i[s.shift()]}return e}function b(t,e){return"object"!=typeof e?t===e:Object.entries(e).every(([e,s])=>b(null==t?void 0:t[e],s))}class j extends k{constructor(t,e){super(t,t=>b(t,e))}}class A extends k{constructor(t,e,s){super(t,void 0===s?t=>!!t[e]:t=>t[e]===s)}}class P extends k{constructor(t,e,s){const i=[].concat(e);super(t,void 0===s?t=>!!I(i,t):t=>I(i,t)===s)}}class E extends x{constructor(t,e){super(),this.p=t,this.fn=e,this.XU0(this.p.value)}process(t,e,s){return this.fn(t,e,s)}}class S extends r{constructor(t,e){super(),this.p=t,this.fn=e,this.XU0(this.p.value)}XR0(){this.mapping=void 0,this.view.XU0(this.view.value={})}XU0(s){this.mapping=e(s)?new S.ArrayMapping:new S.ObjectMapping;const i={};t(s,(t,e)=>{const s=this.fn(e);this.mapping.update(t,s),null!=i[s]||(i[s]={}),i[s][t]=e}),this.view.XU0(this.view.value=i)}BR1(t){const e=[],s=[];for(let i=0;i<t.length;i++){const h=t[i++],n=this.mapping.get(h);if(void 0===n)throw new Error("unexpected group r1: "+h+" "+typeof h);this.mapping.remove(h);const l=this.view.value[n][h];void 0!==l&&(delete this.view.value[n][h],s.push([n,h],l),L(this.view.value[n])&&(e.push(n,this.view.value[n]),delete this.view.value[n]))}this.view.BR1(e),this.view.BR2(s)}BU1(t){const e=[],s=[],i=[],h=[],n=[];for(let i=0;i<t.length;i++){const o=t[i++],r=t[i],a=this.mapping.get(o),v=this.fn(r);if(a===v)s.push([v,o],this.view.value[v][o]=r);else{var l;if(void 0!==a){const t=this.view.value[a][o];delete this.view.value[a][o],e.push([a,o],t),n.push(a)}null!=(l=this.view.value)[v]||(l[v]={}),h.push([v],this.view.value[v][o]=r,o),this.mapping.update(o,v)}}for(const t of n)L(this.view.value[t])&&(i.push(t,this.view.value[t]),delete this.view.value[t]);i.length&&this.view.BR1(i),e.length&&this.view.BR2(e),s.length&&this.view.BU2(s),h.length&&this.view.BI2(h)}BI0(t){const e=[];for(let i=0;i<t.length;i++){var s;const h=t[i++],n=t[i],l=this.fn(n);null!=(s=this.view.value)[l]||(s[l]={}),e.push([l],this.view.value[l][h]=n,h),this.mapping.insert(h,l)}e.length&&this.view.BI2(e)}BR2(){}BU2(){}BI2(){}}S.ArrayMapping=class{constructor(){this.map=[]}insert(t,e){this.map.splice(t,0,e)}update(t,e){this.map[t]=e}remove(t){this.map.splice(t,1)}get(t){return this.map[t]}},S.ObjectMapping=class{constructor(){this.map=new Map}insert(t,e){this.map.set(t,e)}update(t,e){this.map.set(t,e)}remove(t){this.map.delete(t)}get(t){return this.map.get(t)}};class W extends a{constructor(t,e){super(),this.p=t,this.fn=e,this.XU0(this.p.value)}XR0(){this.mapping={},this.view.XU0(this.view.value={})}XU0(e){const s={};this.mapping={},t(e,(t,e)=>{var i,h;void 0!==e&&(this.mapping[t]=null!=(h=s[i=this.fn(e)])?h:s[i]={value:0}).value++}),this.view.XU0(this.view.value=s)}check(t){}BR1(t){const{mapping:e}=this;for(let s=0;s<t.length;s++){const i=t[s++],h=e[i];h&&(h.value--,e[i]=void 0)}this.view.XU0(this.view.value)}BU1(t){const{mapping:e,view:s,fn:i}=this;for(let o=0;o<t.length;o++){var h,n,l;const r=t[o++],a=e[r],v=null!=(l=(h=s.value)[n=i(t[o])])?l:h[n]={value:0};a!==v&&(e[r]=v,a&&a.value--,v.value++)}this.view.XU0(this.view.value)}BI0(t){const{mapping:e,view:s,fn:i}=this;for(let o=0;o<t.length;o++){var h,n,l;const r=t[o++],a=t[o];void 0!==a&&(e[r]=null!=(l=(h=s.value)[n=i(a)])?l:h[n]={value:0}).value++}this.view.XU0(this.view.value)}BR2(){}BU2(){}BI2(){}}class O extends a{constructor(t,e){super(),this.p=t,this.view.value=0,this.XU0(t.value)}XR0(){this.view.XU0(this.view.value=0)}XU0(s){this.view.value=0,e(s)?this.view.XU0(this.view.value=s.length):(t(s,()=>this.view.value++),this.view.XU0(this.view.value))}BR1(t){this.view.XU0(this.view.value-=t.length/2)}BU1(t){}BI0(t){this.view.XU0(this.view.value+=t.length/2)}BR2(){}BU2(){}BI2(){}}class M extends a{constructor(s,...i){super(),this.vp=i[0],this.p=s,this.sources=new Map([[s,{one:1,off:-2}]]),this.all=1;for(const t of i){const e=1<<this.sources.size;t.connect(this),this.sources.set(t[l.view],{one:e,off:~e}),this.all|=e}if("object"!=typeof s.value)return void super.XU0();const h=e(this.p.value)?[]:{};this.filters=e(this.p.value)?[]:{},t(s.value,(t,e)=>{for(const[e,s]of this.sources)t in e.value&&(this.filters[t]|=s.one);this.filters[t]===this.all&&(h[t]=e)}),this.view.XU0(this.view.value=h)}XR0(s,i){const{off:h}=this.sources.get(i);t(this.filters,t=>this.filters[t]&=h),this.view.XU0(this.view.value=e(this.view.value)?[]:{})}XU0(s,i){var h;const{one:n,off:l}=this.sources.get(i);if(null!=(h=this.view).value||(h.value=e(this.p.value)?[]:{}),"object"!=typeof s)return super.XU0(C);null!=this.filters||(this.filters=e(this.p.value)?[]:{});const o=e(this.p.value)?[]:{};t(this.filters,(t,e)=>this.filters[t]=e&l),t(s,t=>{(this.filters[t]|=n)===this.all&&(o[t]=this.p.value[t])}),this.view.XU0(this.view.value=o)}BR1(t,s){var i;const{off:h}=this.sources.get(s),n=[],l=this.all&h;null!=(i=this.view).value||(i.value=e(this.p.value)?[]:{});for(let e=0;e<t.length;e+=2){const s=t[e];(this.filters[s]&h)===l&&(n.push(s,this.view.value[s]),this.view.value[s]=void 0)}this.view.BR1(n)}BU1(t){const{all:e,filters:s}=this,i=[];for(let h=0;h<t.length;h++){const n=t[h++];if(s[n]===e){const t=this.p.value[n];if(t===this.view.value[n])continue;this.view.value[n]=t,i.push(n,t)}}this.view.BU1(i)}BI0(t,s){var i,h;const{all:n,sources:l,filters:o}=this,{one:r}=l.get(s),a=null!=(h=(i=this.view).value)?h:i.value=e(this.p.value)?[]:{},v=[];for(let e=0;e<t.length;e++){const s=t[e++];(o[s]|=r)===n&&v.push(s,a[s]=this.p.value[s])}this.view.BI0(v)}R2(){}U2(){}I2(){}}const $={filter:(t,s)=>"function"==typeof t?k:"string"==typeof t?A:e(t)?P:t.constructor===Object?j:"unexpected filter args",between:()=>B,to:()=>_,debounce:()=>R,map:()=>E,length:t=>"function"==typeof t?W:O,intersect:()=>M,group:()=>S,za:(t,e)=>"string"==typeof t?U:"number"==typeof t?y:0,top:()=>y,limit:()=>X},z=t=>function(e,s,i=0,h=e.length){for(;i<h;){const n=i+h>>>1;t(e[n])<s?i=n+1:h=n}return i};function L(t){for(const e in t)return!1;return!0}const N=Symbol("Node"),{keys:V}=Object,T=(t,e)=>q.render(t,e[N]);class D{constructor(t,e){this.parent=t,this.node=e,this.p=e.data[n],e.data.connect(this),this.XU0(this.p.value)}create_node(t){const s=this.node.generate(t,t===N?this.node.data:this.node.data[t]);if(e(this.nodes)){const e=s.create(this.parent,this.nodes[t+1]);this.nodes.splice(t,0,e)}else this.nodes[t]=s.create(this.parent)}remove_node(t){e(this.nodes)?this.nodes.pop().remove():(this.nodes[t].remove(),delete this.nodes[t])}XR0(){for(const t in this.nodes)this.remove_node(t)}XU0(t){var s;if(!this.parent.parentNode)return;const i=null!=(s=this.nodes)?s:{};if(void 0!==t)if("object"==typeof t){null!=this.nodes||(this.nodes=e(t)?[]:{});for(const e in t)i[e]||this.create_node(e);for(const e in i)e in t||this.remove_node(e)}else{this.nodes={};for(const t in i)this.remove_node(t);this.create_node(N)}else{this.nodes={};for(const t in i)this.remove_node(t)}}BR1(t){for(let e=0;e<t.length;e++)this.remove_node(t[e++])}BU1(t){for(let e=0;e<t.length;e++){const s=t[e++];this.nodes[s]||this.create_node(s)}}BI0(t){for(let e=0;e<t.length;e++){const s=t[e++];this.create_node(s)}}BR2(t){}BU2(t){for(let e=0;e<t.length;e++){const[s]=t[e++];this.nodes[s]||this.create_node(s)}}BI2(t){for(let e=0;e<t.length;e+=3){const[s]=t[e];this.nodes[s]||this.create_node(s)}}}class F{}class q extends F{constructor(t,e,s=[]){super(),this.ns=e,this.tag=t.replaceAll("_","-"),this.children=s}static render(t,e){for(const s of e.children)s.data?t.sink=new D(t,s):s.create(t);return t}get new(){const t=new q(this.tag,this.ns,this.children.concat([]));return t.static=this.static,t.data=this.data,t.fn=this.fn,t}get hasdata(){return void 0!==this.data||void 0!==this.static}static add(e,...s){for(const i of s)if("string"==typeof i||"number"==typeof i||!0===i)e.static=[i];else if(i instanceof Z){const s=i[N];s.static?t(s.static,(t,i)=>e.children.push(s.generate(t,i))):e.children.push(s.fn&&!s.hasdata?s.generate():i[N])}else if(void 0===i||!1===i)e.static=[];else if(i[n])e.data=i;else if("function"==typeof i){const t=e.fn;e.fn=t?(e,...s)=>i(t(e,...s),...s):i}else{if("object"!=typeof i)throw new Error("unexpted arg",i);e.static=i}return new Z(e)}create(t,e){const s=this.ns?document.createElementNS("http://www.w3.org/2000/svg",this.tag):document.createElement(this.tag);return e?t.insertBefore(s,e):t.append(s),q.render(s,this)}generate(t,e){let s=new q(this.tag,this.ns,this.children.concat([]));const i=this.fn?this.fn(new Z(s),e,t):e;return i instanceof Z?s=i[N]:Q.add(s,i),s}}class G extends F{constructor(t,e){super(),this.name=t,this.value=e}static add(t,e,s){return 2==arguments.length&&(s=!0),"object"==typeof e?t.children.push(...V(e).map(t=>new this(t,e[t]))):t.children.push(new this(e,s)),new Z(t)}create(t){var e,s;this.parent=t,null!=(e=this.value)&&e[n]?(null!=t.nrefs||(t.nrefs={}),t.nrefs[this.name]=this.value.connect(this,"set")):null!=(s=this.name)&&s[n]?(null!=t.arefs||(t.arefs=[]),t.arefs.push(this.name.connect(this,"set"))):this.set=this.value}set set(t){!1===t||void 0===t?this.remove():this.add(t)}}class H extends G{add(t){this.parent.setAttribute(this.name,t)}remove(){this.parent.removeAttribute(this.name)}}class J extends G{add(){this.parent.classList.add(this.name)}remove(){this.parent.classList.remove(this.name)}}class K extends G{add(){this.parent.id=this.name}remove(){this.parent.removeAttribute("id")}}class Q extends G{create(t){t.appendChild(this.dom=document.createTextNode("")),super.create(t)}add(){this.dom.textContent=this.name}remove(){this.dom.textContent=""}}const Y={attr:H,class:J,on:class extends G{create(t){t.addEventListener(this.name.toLowerCase(),this.value)}},style:class extends G{add(t){this.parent.style.setProperty(this.name,t)}remove(){this.parent.style.removeProperty(this.name)}},id:K,text:Q,nodes:q};class Z{constructor(t,e){return this.node=t,this.prop=e,new Proxy(s,this)}set(){throw"cannot set properties"}deleteProperty(){throw"cannot delete properties"}get(t,e){const s=this.node;return e===N?s:"symbol"==typeof e?void 0:e in Y?new Z(s,e):e.startsWith("#")?K.add(s.new,e.slice(1),!0):e.startsWith(".")?J.add(s.new,e.slice(1),!0):e.includes("=")?H.add(s.new,...e.split("=")):J.add(s.new,e.replaceAll("_","-"),!0)}apply(t,e,s){var i;return Y[null!=(i=this.prop)?i:"nodes"].add(this.node.new,...s)}getPrototypeOf(t){return Z.prototype}}const tt=new Proxy({},{get:(t,e)=>new Z(new q(e))}),et=new Proxy({},{get:(t,e)=>new Z(new q(e,!0))});export{h as $,tt as HTML,et as SVG,T as render,i as value};
//# sourceMappingURL=data.modern.js.map
